<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>SmartGenEduX - Complete School Management ERP</title>
Â  Â  Â  Â  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
Â  Â  Â  Â  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  body { background-color: #f5f5f5; }
Â  Â  Â  Â  .section-card { transition: all 0.3s ease; cursor: pointer; }
Â  Â  Â  Â  .section-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .module-card { transition: all 0.3s ease; cursor: pointer; position: relative; overflow: hidden; border: 1px solid #e5e7eb; }
Â  Â  Â  Â  .module-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
Â  Â  Â  Â  .premium-badge { position: absolute; top: 10px; right: 10px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 4px 8px; border-radius: 12px; font-size: 10px; font-weight: bold; }
Â  Â  Â  Â  .nav-item { transition: all 0.3s ease; cursor: pointer; padding: 12px 20px; border-radius: 8px; margin: 4px 8px; }
Â  Â  Â  Â  .nav-item:hover { background: rgba(255, 255, 255, 0.1); }
Â  Â  Â  Â  .nav-item.active { background: rgba(255, 255, 255, 0.2); border-left: 4px solid #fff; }
Â  Â  Â  Â  .dashboard-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
Â  Â  Â  Â  .sidebar { background: linear-gradient(180deg, #2d3748 0%, #4a5568 100%); color: white; }
Â  Â  Â  Â  .access-denied { background-color: #fef2f2; color: #dc2626; border: 1px solid #f87171; }
Â  Â  </style>
</head>
<body class="bg-gray-50">
Â  Â  <div id="loginScreen" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
Â  Â  Â  Â  <div class="text-white text-center">
Â  Â  Â  Â  Â  Â  <h1 class="text-3xl mb-4"><i class="fas fa-lock mr-2"></i>Access Denied</h1>
Â  Â  Â  Â  Â  Â  <p class="text-lg mb-6">Please log in to continue.</p>
Â  Â  Â  Â  Â  Â  <button onclick="window.location.href = 'login.html'" class="bg-white text-purple-700 px-6 py-3 rounded-lg font-bold hover:bg-gray-200 transition">
Â  Â  Â  Â  Â  Â  Â  Â  Go to Login
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="flex h-screen hidden" id="dashboard">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="fixed inset-y-0 left-0 w-64 sidebar z-30 shadow-2xl flex flex-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 border-b border-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="assets/SmartGenEduX_20250518_005919_0000.jpg" alt="SmartGenEduX Logo" class="w-10 h-10 rounded-lg object-cover">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-xl font-bold">SmartGenEduX</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-blue-200">School Management ERP</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 border-b border-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 bg-white bg-opacity-30 rounded-full flex items-center justify-center text-sm font-bold" id="userAvatar">U</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-base font-medium" id="userName">User Name</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-yellow-300" id="userRole">Role Loading...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <nav class="flex-1 p-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="nav-item active" onclick="showSection('main')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-home mr-3"></i>Dashboard
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="showSection('admin')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-cogs mr-3"></i>Admin Services
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="showSection('academic')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-graduation-cap mr-3"></i>Academic Tools
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="showSection('premium')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-crown mr-3"></i>Premium AI
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="showSection('settings')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-cog mr-3"></i>System Settings
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </nav>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 border-t border-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="logout()" class="w-full text-left text-red-300 hover:text-red-100 transition duration-150">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-sign-out-alt mr-3"></i>Logout
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-blue-200 mt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Version 2.1</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Â© 2025 SmartGenEduX</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="ml-64 flex-1 overflow-auto">
Â  Â  Â  Â  Â  Â  <header class="dashboard-header shadow-md p-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-2xl font-bold">ERP Control Center</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="opacity-90" id="schoolName">Loading School Data...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white bg-opacity-20 rounded-lg px-4 py-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="schoolSelect" class="bg-transparent text-white text-sm border-none outline-none">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="school_001" class="text-black">Delhi Public School</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showToast('Notifications loading...')"><i class="fas fa-bell"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </header>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <main class="p-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="contentContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-8" id="mainWelcome">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold text-gray-900 mb-2">Welcome to SmartGenEduX!</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600">Select a section in the sidebar to access modules or view your stats below.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6" id="statsGrid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 rounded-lg bg-white shadow flex items-center space-x-3"><i class="fas fa-spinner fa-spin text-blue-600"></i><p class="text-gray-600">Loading Stats...</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="moduleSections" class="space-y-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="admin" class="section-content hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-blue-700">Admin & Financial Services</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('fee-management')"><i class="fas fa-rupee-sign text-3xl text-yellow-600"></i><h4 class="font-bold mt-2">Fee Management</h4><p class="text-xs text-gray-600">Collection, Tally, Reminders.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('attendance')"><i class="fas fa-map-marker-alt text-3xl text-green-600"></i><h4 class="font-bold mt-2">Attendance (GPS/Barcode)</h4><p class="text-xs text-gray-600">Staff and Student Check-in.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('whatsapp')"><i class="fab fa-whatsapp text-3xl text-emerald-600"></i><h4 class="font-bold mt-2">WhatsApp Alerts</h4><p class="text-xs text-gray-600">Automated Parent Comms.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('admission')"><i class="fas fa-user-plus text-3xl text-blue-600"></i><h4 class="font-bold mt-2">Admission Management</h4><p class="text-xs text-gray-600">Workflow & Approvals.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('id-card-generator')"><i class="fas fa-id-card text-3xl text-cyan-600"></i><h4 class="font-bold mt-2">ID Card Generator</h4><p class="text-xs text-gray-600">Issue Staff/Student IDs.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('vipudev-ai')"><i class="fas fa-robot text-3xl text-purple-600"></i><h4 class="font-bold mt-2">VipuDev AI (DevOps)</h4><p class="text-xs text-gray-600">Code generation & audit.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="academic" class="section-content hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-green-700">Academic & Teaching Tools</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('timetable')"><i class="fas fa-calendar-alt text-3xl text-blue-600"></i><h4 class="font-bold mt-2">Timetable Management</h4><p class="text-xs text-gray-600">Scheduling & Conflict Resolution.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('substitution')"><i class="fas fa-exchange-alt text-3xl text-orange-600"></i><h4 class="font-bold mt-2">Teacher Substitution</h4><p class="text-xs text-gray-600">Auto-assign & Leave Mapping.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('invigilation')"><i class="fas fa-eye text-3xl text-indigo-600"></i><h4 class="font-bold mt-2">Invigilation Duty</h4><p class="text-xs text-gray-600">Exam Seating & Staff Allocation.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('reports')"><i class="fas fa-file-alt text-3xl text-red-600"></i><h4 class="font-bold mt-2">Report Tracker</h4><p class="text-xs text-gray-600">Marks Entry & Approval Gate.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('behavior')"><i class="fas fa-heart text-3xl text-purple-600"></i><h4 class="font-bold mt-2">Behavior Tracker</h4><p class="text-xs text-gray-600">Points, Interventions & Rewards.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('qpg')"><i class="fas fa-file-invoice text-3xl text-teal-600"></i><h4 class="font-bold mt-2">Question Paper Gen</h4><p class="text-xs text-gray-600">AI-based Exam Creation.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('qe')"><i class="fas fa-search text-3xl text-cyan-600"></i><h4 class="font-bold mt-2">Question Extractor</h4><p class="text-xs text-gray-600">PDF/DOCX to Question Bank.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('cbse')"><i class="fas fa-book text-3xl text-red-800"></i><h4 class="font-bold mt-2">CBSE Registration</h4><p class="text-xs text-gray-600">9th & 11th Grade Submission.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="premium" class="section-content hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-purple-700">Premium AI & Financial Integrations</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-8 relative access-denied"><div class="premium-badge">PREMIUM</div><h4 class="font-bold mt-2">Timesubbehave AI</h4><p class="text-xs text-gray-600">Advanced predictive behavior analytics.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-8 relative access-denied"><div class="premium-badge">PREMIUM</div><h4 class="font-bold mt-2">Tally Integration</h4><p class="text-xs text-gray-600">Enterprise accounting & reconciliation.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="settings" class="section-content hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-gray-700">System Configuration</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="module-card bg-white rounded-lg shadow-lg p-6" onclick="openModule('documentation-hub')"><i class="fas fa-book-open text-3xl text-gray-600"></i><h4 class="font-bold mt-2">Documentation Hub</h4><p class="text-xs text-gray-600">Policy Editing & Audit Readiness.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  const API_BASE_V1 = '/api/v1';

Â  Â  Â  Â  // --- Authentication and User State ---
Â  Â  Â  Â  let userContext = null;

Â  Â  Â  Â  function checkAuthentication() {
Â  Â  Â  Â  Â  Â  const token = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
Â  Â  Â  Â  Â  Â  const userInfo = sessionStorage.getItem('currentUserInfo');

Â  Â  Â  Â  Â  Â  if (!token || !userInfo) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loginScreen').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dashboard').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  document.getElementById('loginScreen').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('dashboard').classList.remove('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  userContext = JSON.parse(userInfo);
Â  Â  Â  Â  Â  Â  updateUserInfo();
Â  Â  Â  Â  Â  Â  loadDashboardStats();
Â  Â  Â  Â  Â  Â  showSection('main');Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function getRoleDisplayName(role) {
Â  Â  Â  Â  Â  Â  const roleNames = {
Â  Â  Â  Â  Â  Â  Â  Â  'super_admin': 'Super Administrator',
Â  Â  Â  Â  Â  Â  Â  Â  'school_admin': 'School Administrator',
Â  Â  Â  Â  Â  Â  Â  Â  'teacher': 'Teacher'
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  return roleNames[role] || role.split('_').join(' ');
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateUserInfo() {
Â  Â  Â  Â  Â  Â  if (userContext) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('userName').textContent = userContext.fullName || 'Administrator';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('userRole').textContent = getRoleDisplayName(userContext.role);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('userEmail').textContent = userContext.email;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('userAvatar').textContent = userContext.fullName ? userContext.fullName.charAt(0) : 'U';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('schoolName').textContent = userContext.tenant || 'Global HQ';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function loadDashboardStats() {
Â  Â  Â  Â  Â  Â  const token = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
Â  Â  Â  Â  Â  Â  if (!token) return;

Â  Â  Â  Â  Â  Â  const statsGrid = document.getElementById('statsGrid');
Â  Â  Â  Â  Â  Â  statsGrid.innerHTML = '<div class="p-4 rounded-lg bg-white shadow flex items-center space-x-3"><i class="fas fa-spinner fa-spin text-blue-600"></i><p class="text-gray-600">Loading Stats...</p></div>';

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`${API_BASE_V1}/dashboard-stats`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Authorization': `Bearer ${token}` }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  const stats = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const statsData = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { icon: 'ðŸ«', value: stats.totalSchools || '0', label: 'Total Schools' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { icon: 'ðŸ‘¨â€ðŸ«', value: stats.totalTeachers || '0', label: 'Teaching Staff' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { icon: 'ðŸ‘¥', value: stats.totalStudents || '0', label: 'Total Students' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { icon: 'ðŸ’°', value: stats.feeCollection || 'â‚¹0', label: 'Monthly Collection' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statsGrid.innerHTML = statsData.map(stat => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 rounded-lg bg-white shadow flex items-center space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-2xl text-purple-600">${stat.icon}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-lg font-bold">${stat.value}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-gray-500">${stat.label}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  statsGrid.innerHTML = '<div class="p-4 rounded-lg bg-white shadow access-denied"><i class="fas fa-exclamation-circle"></i> Error loading stats.</div>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Module Access and Navigation ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  const moduleAccess = {
Â  Â  Â  Â  Â  Â  'super_admin': ['all'],Â 
Â  Â  Â  Â  Â  Â  'school_admin': [
Â  Â  Â  Â  Â  Â  Â  Â  'fee-management', 'attendance', 'whatsapp', 'pdf-tools', 'admission', 'events',
Â  Â  Â  Â  Â  Â  Â  Â  'timetable', 'substitution', 'invigilation', 'distribution', 'reports', 'behavior',
Â  Â  Â  Â  Â  Â  Â  Â  'question-paper', 'question-extractor', 'vipu-ai', 'tally-integration', 'id-card-generator'
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  'teacher': [
Â  Â  Â  Â  Â  Â  Â  Â  'attendance', 'timetable', 'substitution', 'reports', 'behavior',
Â  Â  Â  Â  Â  Â  Â  Â  'question-paper', 'question-extractor', 'vipu-ai'
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  };

Â  Â  Â  Â  function hasModuleAccess(moduleName) {
Â  Â  Â  Â  Â  Â  if (!userContext) return false;
Â  Â  Â  Â  Â  Â  const role = userContext.role;
Â  Â  Â  Â  Â  Â  const accessList = moduleAccess[role] || [];
Â  Â  Â  Â  Â  Â  return accessList.includes('all') || accessList.includes(moduleName);
Â  Â  Â  Â  }

Â  Â  Â  Â  function showSection(sectionId) {
Â  Â  Â  Â  Â  Â  // Logic to switch the sidebar nav item
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
Â  Â  Â  Â  Â  Â  // NOTE: Using a simple workaround since event.target is not available here:
Â  Â  Â  Â  Â  Â  const targetElement = document.querySelector(`.nav-item[onclick*="'${sectionId}'"]`);
Â  Â  Â  Â  Â  Â  if (targetElement) targetElement.classList.add('active');

Â  Â  Â  Â  Â  Â  // Logic to switch content views
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.section-content').forEach(content => content.classList.add('hidden'));

Â  Â  Â  Â  Â  Â  if (sectionId === 'main') {
Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('mainWelcome').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('moduleSections').classList.add('hidden');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('mainWelcome').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('moduleSections').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById(sectionId).classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function openModule(moduleName) {
Â  Â  Â  Â  Â  Â  const moduleUrls = {
Â  Â  Â  Â  Â  Â  Â  Â  'timetable': 'modules/timetable.html',
Â  Â  Â  Â  Â  Â  Â  Â  'attendance': 'modules/attendance.html',
Â  Â  Â  Â  Â  Â  Â  Â  'fee-management': 'modules/fee-management.html',
Â  Â  Â  Â  Â  Â  Â  Â  'behavior': 'modules/student-behavior.html',
Â  Â  Â  Â  Â  Â  Â  Â  'substitution': 'modules/substitution.html',
Â  Â  Â  Â  Â  Â  Â  Â  'reports': 'modules/report-tracker.html',
Â  Â  Â  Â  Â  Â  Â  Â  'events': 'modules/school-events.html',
Â  Â  Â  Â  Â  Â  Â  Â  'whatsapp': 'modules/whatsapp-alerts.html',
Â  Â  Â  Â  Â  Â  Â  Â  'vipu-ai': 'modules/vipu-ai.html',
Â  Â  Â  Â  Â  Â  Â  Â  'pdf-tools': 'modules/pdf-tools.html',
Â  Â  Â  Â  Â  Â  Â  Â  'admission': 'modules/admission-management.html',
Â  Â  Â  Â  Â  Â  Â  Â  'invigilation': 'modules/invigilation-duty.html',
Â  Â  Â  Â  Â  Â  Â  Â  'distribution': 'modules/student-distribution.html',
Â  Â  Â  Â  Â  Â  Â  Â  'question-paper': 'modules/question-paper.html',
Â  Â  Â  Â  Â  Â  Â  Â  'question-extractor': 'modules/question-extractor.html',
Â  Â  Â  Â  Â  Â  Â  Â  'voice-to-text': 'modules/voice-to-text.html',
Â  Â  Â  Â  Â  Â  Â  Â  'ai-premium': 'modules/timesubbehave-ai.html',
Â  Â  Â  Â  Â  Â  Â  Â  'tally-integration': 'modules/fee-tally-integration.html',
Â  Â  Â  Â  Â  Â  Â  Â  'vipudev-ai': 'modules/vipudev-ai.html',
Â  Â  Â  Â  Â  Â  Â  Â  'id-card-generator': 'modules/id-card-generator.html',
Â  Â  Â  Â  Â  Â  Â  Â  'documentation-hub': 'modules/documentation-hub.html'
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  if (!hasModuleAccess(moduleName)) {
Â  Â  Â  Â  Â  Â  Â  Â  showAccessDenied(moduleName);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (moduleUrls[moduleName]) {
Â  Â  Â  Â  Â  Â  Â  Â  window.open(moduleUrls[moduleName], '_blank');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â showToast(`${moduleName} module opening...`, 'info');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showAccessDenied(moduleName) {
Â  Â  Â  Â  Â  Â  const role = userContext.role;
Â  Â  Â  Â  Â  Â  alert(`ACCESS DENIED: Your role (${getRoleDisplayName(role)}) cannot access the ${moduleName} module.`);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showToast(message, type = 'info') {
Â  Â  Â  Â  Â  Â  // Simple toast simulation
Â  Â  Â  Â  Â  Â  console.log(`[TOAST] ${type.toUpperCase()}: ${message}`);
Â  Â  Â  Â  }

Â  Â  Â  Â  function logout() {
Â  Â  Â  Â  Â  Â  localStorage.removeItem('authToken');
Â  Â  Â  Â  Â  Â  sessionStorage.clear();
Â  Â  Â  Â  Â  Â  window.location.href = 'login.html';
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Initialization ---
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  Â checkAuthentication();
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
